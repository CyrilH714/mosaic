{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/posts/post-detail.css' %}" />
<style>
  #comments-section {
    display: none;
    margin-top: 1rem;
  }
  .btn {
    padding: 0.5rem 1rem;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
</style>
{% endblock %}

{% block content %}
<section class="post-container">
  <div class="post-details">
    <h1>{{ post.title }}</h1>
    <p>{{ post.body }}</p>
    <p>Tags: {{ post.tags }}</p>
    <p>Country: {{ post.country.name }}</p>
    {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-img" />
    {% endif %}
  </div>

  <div class="post-actions">
    {% if post.user == request.user %}
      <a href="{% url 'post-update' post.id %}">Edit</a> |
      <a href="{% url 'post-delete' post.id %}">Delete</a>
    {% endif %}
  </div>

  <button id="toggle-comments-btn" class="btn">Show Comments</button>

  <div id="comments-section">
    <form action="{% url 'add-comment' post.id %}" method="post" class="comment-form" autocomplete="off">
      {% csrf_token %}
      {{ comment_form.text }}
      <button type="submit" class="btn submit">Add Comment</button>
    </form>

    <div class="comments-container">
      {% for comment in post.comment_set.all %}
        <div class="comment-item">
          <div class="comment-header">
            <span class="comment-user">{{ comment.user.username }}</span>
            <span class="comment-date">{{ comment.date|date:"M d, Y" }}</span>
            {% if comment.user == request.user %}
              <span class="comment-actions">
                <a href="{% url 'comment-edit' comment.id %}">‚úèÔ∏è</a> |
                <a href="{% url 'comment-delete' comment.id %}">üóëÔ∏è</a>
              </span>
            {% endif %}
          </div>
          <div class="comment-text">{{ comment.text }}</div>

          <form method="post" action="{% url 'add-comment' post.id %}">
            {% csrf_token %}
            {{ comment_form.text }}
            <input type="hidden" name="parent_id" value="{{ comment.id }}">
            <button type="submit">Reply</button>
          </form>

          {% for reply in comment.replies.all %}
            <div class="reply-item">
              ‚Ü≥ <span class="comment-user">{{ reply.user.username }}</span>
              <span class="comment-date">{{ reply.date|date:"M d, Y" }}</span>
              <div class="comment-text">{{ reply.text }}</div>
            </div>
          {% endfor %}
        </div>
      {% empty %}
        <p>No comments yet. Be the first to comment!</p>
      {% endfor %}
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("toggle-comments-btn");
    const commentsSection = document.getElementById("comments-section");

    toggleBtn.addEventListener("click", function () {
      if (commentsSection.style.display === "none" || commentsSection.style.display === "") {
        commentsSection.style.display = "block";
        toggleBtn.textContent = "Hide Comments";
      } else {
        commentsSection.style.display = "none";
        toggleBtn.textContent = "Show Comments";
      }
    });
  });
</script>
{% endblock %}
