{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/posts/user_feed.css' %}" />
{% endblock %}

{% block content %}
<section class="page-header">
  <h1>My Feed (All Posts)</h1>
</section>
<section class="filter-search">
  <form method="get" class="feed-filters">
    <fieldset>
      <legend>Search</legend>
      <input type="text" name="q" placeholder="Search posts..." value="{{ query }}">
      <label>
        <input type="checkbox" name="tags_only" {% if tags_only %}checked{% endif %}>
        Tags only
      </label>
    </fieldset>

    <div class="filter-row">
      <fieldset>
        <legend>Continent</legend>
        <select id="continent-select" name="continent">
          <option value="">All Continents</option>
          {% for cont in continents %}
            <option value="{{ cont }}" {% if cont == selected_continent %}selected{% endif %}>{{ cont }}</option>
          {% endfor %}
        </select>
      </fieldset>

      <fieldset>
        <legend>Country</legend>
        <select id="country-select" name="country">
          <option value="">All Countries</option>
          {% for code, name in countries %}
            <option value="{{ code }}" {% if code == selected_country %}selected{% endif %}>{{ name }}</option>
          {% endfor %}
        </select>
      </fieldset>
    </div>

    <fieldset>
      <legend>Sort</legend>
      <select name="sort">
        <option value="recent" {% if sort == "recent" %}selected{% endif %}>Most Recent</option>
        <option value="oldest" {% if sort == "oldest" %}selected{% endif %}>Oldest First</option>
      </select>
    </fieldset>

    <button type="submit">Apply</button>
  </form>
</section>
<section class="post-list">
  {% for post in posts %}
  <a href="{% url 'post_detail' post.id %}" class="post-card-link">
    <article class="post-item">
      <h2>{{ post.title }}</h2>
      {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-img" />
      {% endif %}
      <p>{{ post.body|truncatewords:30 }}</p>
      <p>Tags: {{ post.tags }}</p>
      <p>Posted by: {{ post.user.username }}</p>
    </article>
  </a>
  {% empty %}
  <p>No posts available.</p>
  {% endfor %}
</section>
{% endblock %}
