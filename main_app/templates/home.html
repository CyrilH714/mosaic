{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/home.css' %}" />
<style>
  /* Simple styles for translation popup */
  #translation-popup {
    margin-top: 1rem;
    padding: 1rem;
    border: 1px solid #007bff;
    background-color: #e9f5ff;
    display: none;
  }
  #translate-btn {
    margin-top: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<section class="home-section">
  {% if user.is_authenticated %}
    <h1>Connectly: Your Global Community Awaits</h1>
    <p id="intro-text">
      Discover a world without borders â€” Connectly brings people from every corner
      of the globe together to share, learn, and build meaningful friendships.
      Whether you want to explore new cultures, find language partners, or simply
      connect with amazing people worldwide, Connectly is your space to make it
      happen. Join us and start your global journey today!
    </p>
    
    <button id="translate-btn">Translate to Chinese</button>

    <div id="translation-popup"></div>

  {% else %}
    <section>
      <form action="{% url 'home' %}" method="post" class="login">
        <h1>Login</h1>
        {% csrf_token %}
        {{ form.as_p }}
        <input type="hidden" name="next" value="{{ next }}" />
        <button type="submit" class="btn submit">Login</button>
      </form>
    </section>
  {% endif %}
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const translateBtn = document.getElementById('translate-btn');
    const introText = document.getElementById('intro-text').textContent.trim();
    const translationPopup = document.getElementById('translation-popup');

    translateBtn.addEventListener('click', () => {
      fetch("{% url 'translate' %}", {
        method: "POST",
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: new URLSearchParams({
          input: introText
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.translation) {
          translationPopup.style.display = 'block';
          translationPopup.textContent = data.translation;
        } else if (data.error) {
          translationPopup.style.display = 'block';
          translationPopup.textContent = 'Error: ' + data.error;
        }
      })
      .catch(err => {
        translationPopup.style.display = 'block';
        translationPopup.textContent = 'An error occurred while translating.';
      });
    });
  });
</script>

{% endblock %}
